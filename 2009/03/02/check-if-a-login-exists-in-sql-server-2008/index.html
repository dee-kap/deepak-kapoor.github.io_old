
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Check If A Login Exists In SQL Server 2008 - Debug > Release ></title>
  <meta name="author" content="Deepak Kapoor">

  
  <meta name="description" content="If you are creating a SQL Server login using a script then it is advisable to check if the login you are creating already exists. If you do not do &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://deepak-kapoor.github.io/2009/03/02/check-if-a-login-exists-in-sql-server-2008">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Debug > Release >" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<link href="/stylesheets/debrel.css" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Debug > Release ></a></h1>
  
    <h2>Programming notes of Deepak Kapoor</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:deepak-kapoor.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Check if a Login Exists in SQL Server 2008</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-03-02T00:00:00+11:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you are creating a SQL Server login using a script then it is advisable to check if the login you are creating already exists. If you do not do this then SQL Server will throw an error. For example if I execute this statement when a login with name test_user already exists, I will get the following error.</p>  <pre class="code"><span style="color: blue">CREATE LOGIN </span>test_user <span style="color: blue">WITH PASSWORD </span><span style="color: gray">= </span><span style="color: red">'Password123'</span></pre>

<pre class="code"><span style="color: red">
</span></pre>
<a href="http://11011.net/software/vspaste"></a>

<pre class="code"><font color="#ff0000">Msg 15025, Level 16, State 1, Line 1
The server principal 'test_user' already exists.</font></pre>
<a href="http://11011.net/software/vspaste"></a>

<p>To avoid this a check can be used before creating the login. One way to do this is to write a statement like this.</p>

<pre class="code"><span style="color: blue">IF </span><span style="color: gray">NOT EXISTS(</span><span style="color: blue">SELECT </span>name <span style="color: blue">FROM master</span><span style="color: gray">.</span>dbo<span style="color: gray">.</span><span style="color: green">syslogins </span><span style="color: blue">WHERE </span>name <span style="color: gray">= </span><span style="color: red">'test_user'</span><span style="color: gray">)
</span><span style="color: blue">BEGIN
    CREATE LOGIN </span>test_user <span style="color: blue">WITH PASSWORD </span><span style="color: gray">= </span><span style="color: red">'Password123'
</span><span style="color: blue">END
</span></pre>
<a href="http://11011.net/software/vspaste"></a>

<p>&#160;</p>

<p>The above statement will check for the login and it will only create it if the login does not already exist. This works but it is not the best way to do it in SQL Server 2008. The problem is that we are querying <strong>master.dbo.syslogins</strong> which is available only for backward compatibility and as per Microsoft it will be removed in future versions. So the best way to do a check before creating a login is to use <strong>sys.sql_logins</strong> or <strong>sys.server_principals</strong> system view. Our statement can be re-written in following two ways.</p>

<pre class="code"><span style="color: blue">IF </span><span style="color: gray">NOT EXISTS(</span><span style="color: blue">SELECT </span>name <span style="color: blue">FROM </span><span style="color: green">sys</span><span style="color: gray">.</span><span style="color: green">server_principals </span><span style="color: blue">WHERE </span>name <span style="color: gray">= </span><span style="color: red">'test_user'</span><span style="color: gray">)
</span><span style="color: blue">BEGIN
    CREATE LOGIN </span>test_user <span style="color: blue">WITH PASSWORD </span><span style="color: gray">= </span><span style="color: red">'Password123'
</span><span style="color: blue">END</span></pre>
<a href="http://11011.net/software/vspaste"></a>

<p>&#160;</p>

<p>OR</p>

<pre class="code"><span style="color: blue">IF </span><span style="color: gray">NOT EXISTS(</span><span style="color: blue">SELECT </span>name <span style="color: blue">FROM </span><span style="color: green">sys</span><span style="color: gray">.</span><span style="color: green">sql_logins </span><span style="color: blue">WHERE </span>name <span style="color: gray">= </span><span style="color: red">'test_user'</span><span style="color: gray">)
</span><span style="color: blue">BEGIN
    CREATE LOGIN </span>test_user <span style="color: blue">WITH PASSWORD </span><span style="color: gray">= </span><span style="color: red">'Password123'
</span><span style="color: blue">END</span></pre>

<p><a href="http://11011.net/software/vspaste"></a></p>

<p>This approach will ensure that your script will work in future versions of SQL Server when Microsoft decides to remove master.dbo.syslogins.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Deepak Kapoor</span></span>

      








  


<time datetime="2009-03-02T00:00:00+11:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/sql-server/'>SQL Server</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://deepak-kapoor.github.io/2009/03/02/check-if-a-login-exists-in-sql-server-2008/" data-via="" data-counturl="http://deepak-kapoor.github.io/2009/03/02/check-if-a-login-exists-in-sql-server-2008/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/03/02/bypass-windows-password-requirements-for-sql-login/" title="Previous Post: Bypass Windows Password Requirements For SQL Login">&laquo; Bypass Windows Password Requirements For SQL Login</a>
      
      
        <a class="basic-alignment right" href="/2009/03/03/sql-server-2008-find-if-a-database-is-offline-with-t-sql/" title="Next Post: SQL Server 2008 – Find If A Database Is Offline With T-SQL">SQL Server 2008 – Find If A Database Is Offline With T-SQL &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/07/31/linux-set-wireless-bit-rate-permanently-on-ubuntu-or-linux-mint/">Linux - Set Wireless Bit Rate Permanently on Ubuntu or Linux Mint</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/31/android-expandablelistview-tutorial/">Android - ExpandableListView Tutorial</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/28/linux-install-handbrake-on-linux-mint-15/">Linux - Install Handbrake on Linux Mint 15</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/26/linux-virtualbox-windows-host-share-in-ubuntu-guest/">Linux VirtualBox - Windows Host Share in Ubuntu Guest</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/25/linux-setgid-on-directory-and-share-directory-with-users/">Linux - Setgid on Directory and Share Directory With Users</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Deepak Kapoor -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
