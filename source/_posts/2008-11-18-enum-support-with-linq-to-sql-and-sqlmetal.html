---
layout: post
title: Enum Support With LINQ To SQL And SqlMetal
categories:
- .NET
- Microsoft
tags:
- LINQ
status: publish
type: post
published: true
meta:
  _wpas_done_all: '1'
  views: '12133'
  _edit_last: '1'
  _wp_rp_extracted_image_url: http://www.debugrelease.com/wp-content/uploads/2013/04/image62-150x150.jpg
  _wp_rp_extracted_image_url_full: http://www.debugrelease.com/wp-content/uploads/2013/04/image62.png
  simplecatch-sidebarlayout: ''
---
<p>As a programmer I love my enums. I find code written using enums to be more readable than without them. However, there has been and there still is a disconnect between lookup tables in a database and enums in code. One has to restore to some creative trickery to get them working in harmony. Recently while working on a project which involves using LINQ To SQL, I came up with a process which gives me the best of both worlds i.e. using lookup tables in database and enums in code. I am documenting my solution here. Hopefully it will help you.</p>  <p>&#160;</p>  <h4>The problem</h4>  <p>In my database I have two tables. To make things simple I will call them Customer and CustomerStatus. Customer table stores information about a customer and CustomerStatus table is a lookup table which will store values such as &quot;Active&quot; and &quot;Inactive&quot;.</p>  <p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="146" alt="image" src="http://www.debugrelease.com/wp-content/uploads/2008/11/image6.png" width="459" border="0" /> </p>  <p>For CustomerStatus I would like to use an enum in code. This can be done using the designer as explained <a href="http://geekswithblogs.net/robp/archive/2008/05/19/using-c-enumerations-as-linq-to-sql-entity-properties.aspx">here</a>. But I would like to use SqlMetal to automate code generation. SqlMetal does not have any options which can be used to solve my problem.</p>  <p>&#160;</p>  <h4>My Solution</h4>  <p>My solution is to generate dbml file using SqlMetal, then run a custom process which modifies dbml to make it enum ready and finally generate code using SqlMetal looking over dbml file.</p>  <p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="281" alt="image" src="http://www.debugrelease.com/wp-content/uploads/2008/11/image7.png" width="261" border="0" /> </p>  <h5>Step 1</h5>  <p>Step 1 is to generate a dbml file from database using SQLMetal with a statement like this:</p>  <p><font color="#000080">SqlMetal /server:. /database:CustomerDb /dbml:CustomerDb.dbml /namespace:CustomerApp</font></p>  <p>In the dbml file I look at the column element generated for CustomerStatusID in Customer Table node. I find that it's Type is set to System.Int32</p>  <p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="68" alt="image" src="http://www.debugrelease.com/wp-content/uploads/2008/11/image8.png" width="292" border="0" /> </p>  <h5>Step 2</h5>  <p>Step 2 involves writing a process which could just be a simple console application. This process looks for usage of lookup table's Id colum in main table and replaces the value of Type attribute with corresponding enum. I am following a naming convention so that my enums are all suffixed with Enum and in database the foreign key field on my main table is named &lt;lookup table name&gt; + Id.</p>  <p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="67" alt="image" src="http://www.debugrelease.com/wp-content/uploads/2008/11/image9.png" width="278" border="0" /> </p>  <h5>Step 3 </h5>  <p>Generate code with SqlMetal. Use the option which works with a dbml file. Here is a sample statement:</p>  <p><font color="#000080">SqlMetal /code:Customer.cs /map:CustomerDb.map CustomerDb.dbml</font></p>  <div>&#160;</div>  <div>Generated code now uses the enum for CustomerStatusId property rather than System.Int32</div>  <div>&#160;</div>  <div><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="370" alt="image" src="http://www.debugrelease.com/wp-content/uploads/2008/11/image10.png" width="359" border="0" /> </div>  <h5>Step 4</h5>  <p>A batch file can be created to tie this all up. Batch file will do the following things:</p>  <ol>   <li>Run SqlMetal to generate dbml file </li>    <li>Run the process which modifies dbml file as mentioned in step 2 </li>    <li>Generate code using SqlMetal from dbml file </li> </ol>  <p>&#160;</p>  <p>Doing this allows me to work with enums in my code and at the same use lookup tables in database. As an addition a simple process can also be written which can populate lookup tables with the values from enums.</p>  <p>&#160;</p> <a href="http://www.dotnetkicks.com/kick/?url=http%3a%2f%2fwww.thereforesystems.com%2fenum-support-with-linq-to-sql-and-sqlmetal%2f"><img alt="kick it on DotNetKicks.com" src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http%3a%2f%2fwww.thereforesystems.com%2fenum-support-with-linq-to-sql-and-sqlmetal%2f" border="0" /></a>
