
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Remove Duplicate Lines From A Text File Using LINQ - Debug Release</title>
  <meta name="author" content="Deepak Kapoor">

  
  <meta name="description" content="A question was posted on c-sharpcorner forums asking how you would remove duplicate lines from a text file. It got me thinking about how this problem &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.debugrelease.com/2008/12/12/remove-duplicate-lines-from-a-text-file-using-linq">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Debug Release" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<link href="/stylesheets/debrel.css" rel="stylesheet" type="text/css">
<meta name="google-site-verification" content="lgYJWL_s1AZLFOqJ9ejrQhbIkJcvzpsBZnUBGHcNk-w" />

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Debug Release</a></h1>
  
    <h2>Hacking notes of Deepak Kapoor</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.debugrelease.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Remove Duplicate Lines From a Text File Using LINQ</h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-12-12T00:00:00+11:00" pubdate data-updated="true">Dec 12<span>th</span>, 2008</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>A question was posted on c-sharpcorner forums asking how you would <a href="http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=51446">remove duplicate lines from a text file</a>. It got me thinking about how this problem could be addressed using LINQ. Before I get into the solution, here is the problem statement. </p>  <h4>The problem</h4>  <blockquote>   <p>I am trying to remove duplicate lines from a text file. To make things difficult the lines contain non unique timestamps but a unique reference number. Some of the duplicates amount to 10 lines whereas others can only be 2 lines.</p>    <p>     <br />1. Here are some examples of duplicates lines:&lt;timestamp&gt;,&lt;reference&gt;,&lt;error message&gt;       <br />08:47:22,95847170050,Problem inputting data.       <br />08:48:28,96672540040,More problems inputting data.       <br />08:49:29,95847170050,Problem inputting data.       <br />08:55:28,106622510040,Extra issues inputting data.       <br />08:56:35,95847170050,Problem inputting data.       <br />08:57:35,106622510040,Extra issues inputting data.       <br />09:02:35,96672540040,More problems inputting data.       <br />09:03:41,96672540040,More problems inputting data.       <br />09:04:41,106622510040,Extra issues inputting data.       <br /></p>   <b></b>    <p><b>I want to delete all but KEEP the most recent duplicate line.</b></p> </blockquote>  <p>On the forum there is also some Java code which has been used as a solution. But I will ignore it so that I can approach it from a fresh perspective.</p>  <p>&#160;</p>  <h4>Solution The LINQ Way</h4>  <p>Here is my approach to remove duplicate lines from a text file. Firstly, I read the contents of the file into a collection of Type List&lt;Error&gt; using an approach <a href="http://www.debugrelease.com/tutorial-reading-a-text-file-using-linq/">I described in an earlier post</a> .</p>  

<pre class="lang:c# decode:true " >
var query = from e in
  (from line in File.ReadAllLines(originalFile)
    let errorRecord = line.Split(',')
    let timestamp = errorRecord[0].Split(':')
    select new Error() 
    {                           
      TimeStamp = new TimeSpan(
        Convert.ToInt32(timestamp[0]), 
        Convert.ToInt32(timestamp[1]), 
        Convert.ToInt32(timestamp[2])),
      Reference = errorRecord[1],
      Message = errorRecord[2]
    })
  select e;
</pre>

<p>This is what my Error class looks like. This class maps to a record in the file.</p>

<pre class="lang:c# decode:true " >
public class Error
{
  public TimeSpan TimeStamp { get; set; }
  public string Reference { get; set; }
  public string Message { get; set; }
}
</pre>

<p>Once I have the collection loaded up from the file. I then use a LINQ query to select the results I want. This query uses combination of group by and aggregates to select the most current record for a reference number as per the original problem statement.</p>

<pre class="lang:c# decode:true " >
var query = from e in errorCollection
  group e by new { e.Reference, e.Message } into g
  let MaxDate = g.Max(x => x.TimeStamp)
  select new Error 
  {
    TimeStamp = MaxDate,
    Reference = g.Key.Reference, 
    Message = g.Key.Message
  };
</pre>

<p>Finally I write the collection I get from the query above to another text file.</p>

<pre class="lang:c# decode:true " >
List<Error> newList = query.ToList();

using (StreamWriter sw = new StreamWriter(processedFile))
{
  newList.ForEach(x => sw.WriteLine(x.TimeStamp+","+x.Reference+","+x.Message));
  sw.Close();
}
</pre>

<p>The code which loads the collection from the file can be optimized for performance but it does a good job when dealing with a reasonably small file. Below is the full code for my two methods.</p>

<pre class="lang:c# decode:true " >
public void RemoveDuplicates(string originalFile, string processedFile)
{
  List<Error> errorCollection = ReadFileIntoCollection(originalFile);
            
  var query = from e in errorCollection
    group e by new { e.Reference, e.Message } into g
    let MaxDate = g.Max(x => x.TimeStamp)
    select new Error 
    {
      TimeStamp = MaxDate,
      Reference = g.Key.Reference, 
      Message = g.Key.Message
    };

  List<Error> newList = query.ToList();

  using (StreamWriter sw = new StreamWriter(processedFile))
  {
    newList.ForEach(x => sw.WriteLine(x.TimeStamp+","+x.Reference+","+x.Message));
    sw.Close();
  }
}

public List<Error> ReadFileIntoCollection(string originalFile)
{
  List<Error> errorCollection = null;

  var query = from e in
    (from line in File.ReadAllLines(originalFile)
    let errorRecord = line.Split(',')
    let timestamp = errorRecord[0].Split(':')
    select new Error() 
    {
      TimeStamp = new TimeSpan(
        Convert.ToInt32(timestamp[0]), 
        Convert.ToInt32(timestamp[1]), 
        Convert.ToInt32(timestamp[2])),
      Reference = errorRecord[1],
      Message = errorRecord[2]
    })
    select e;

  errorCollection = query.ToList<Error>();
  return errorCollection;
}
</pre>

<p>So this is my approach to remove duplicates from a text file using LINQ. This is just one example of how LINQ can be used to create creative solutions to some common programming problem. The power of LINQ lies in its simplicity which you can use to write beautiful code. </p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Deepak Kapoor</span></span>

      








  


<time datetime="2008-12-12T00:00:00+11:00" pubdate data-updated="true">Dec 12<span>th</span>, 2008</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dot-net/'>.NET</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.debugrelease.com/2008/12/12/remove-duplicate-lines-from-a-text-file-using-linq/" data-via="" data-counturl="http://www.debugrelease.com/2008/12/12/remove-duplicate-lines-from-a-text-file-using-linq/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2008/12/04/the-era-of-cloud-computing-consultant/" title="Previous Post: The Era of Cloud Computing Consultant">&laquo; The Era of Cloud Computing Consultant</a>
      
      
        <a class="basic-alignment right" href="/2008/12/23/linqpad-with-intellisense/" title="Next Post: LINQPad with Intellisense">LINQPad with Intellisense &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/07/31/linux-set-wireless-bit-rate-permanently-on-ubuntu-or-linux-mint/">Linux - Set Wireless Bit Rate Permanently on Ubuntu or Linux Mint</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/31/android-expandablelistview-tutorial/">Android - ExpandableListView Tutorial</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/28/linux-install-handbrake-on-linux-mint-15/">Linux - Install Handbrake on Linux Mint 15</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/26/linux-virtualbox-windows-host-share-in-ubuntu-guest/">Linux VirtualBox - Windows Host Share in Ubuntu Guest</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/25/linux-setgid-on-directory-and-share-directory-with-users/">Linux - Setgid on Directory and Share Directory With Users</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/03/linux-number-of-files-in-directory/">Linux - Number of Files in Directory</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/24/android-listview-tutorial-with-images-and-text/">Android - ListView Tutorial With Images and Text</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/19/android-listview-tutorial/">Android - ListView Tutorial</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/11/android-linear-layout-example/">Android - Linear Layout Example</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/02/ubuntu-font-and-zenburn-i-like-to-make-my-code-look-good/">Ubuntu Font and Zenburn - I Like to Make My Code Look Good</a>
      </li>
    
  </ul>
</section>
<div id="fb-root"></div>
<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	    if (d.getElementById(id)) return;
	      js = d.createElement(s); js.id = id;
	        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=295226453878610";
		  fjs.parentNode.insertBefore(js, fjs);
		  }(document, 'script', 'facebook-jssdk'));</script>
	  <div style="text:align:center">
		  <div class="fb-like-box" data-href="https://www.facebook.com/pages/Debug-Release/473369436071930" data-width="250" data-show-faces="true" data-stream="false" data-show-border="true" data-header="false"></div></div>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Deepak Kapoor -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=8878331; 
var sc_invisible=0; 
var sc_security="f0e88835"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counters" href="http://statcounter.com/free-hit-counter/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/8878331/0/f0e88835/0/"
alt="free hit counters"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://plus.google.com/105555323627924521684?rel=author">Google Profile</a>
<script type='text/javascript'>
    function _dmBootstrap(file) { 
        var _dma = document.createElement('script');  
        _dma.type = 'text/javascript'; 
        _dma.async = true;  
        _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + file; 
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined')  _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js'); setTimeout(_dmFollowup, 2000);})();
</script>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'debugrelease';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
